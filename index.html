<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWABuilderê°€ ì •ë³´ë¥¼ ì°¾ì§€ ëª»í•  ë•Œë¥¼ ëŒ€ë¹„í•œ 2ì¤‘ ì•ˆì „ ì¥ì¹˜ (ë©”íƒ€ íƒœê·¸) -->
    <title>ë¡œê·¸ë¦¿</title>
    <meta name="application-name" content="ë¡œê·¸ë¦¿">
    <meta name="apple-mobile-web-app-title" content="ë¡œê·¸ë¦¿">
    <meta name="description" content="ë§¤ì¶œì¥ë¶€ì™€ ìŠ¤ì¼€ì¤„ì„ í•˜ë‚˜ë¡œ í•©ì¹œ íš¨ìœ¨ì ì¸ ê´€ë¦¬ í”„ë¡œê·¸ë¨">
    
    <link rel="icon" type="image/png" href="./icon.png">
    <link rel="apple-touch-icon" href="./icon.png">
    <link rel="shortcut icon" href="./icon.png">
    
    <!-- PWABuilder ì—ëŸ¬(Missing Name/Description) í•´ê²°ì„ ìœ„í•œ í‘œì¤€ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ (V140) -->
    <link rel="manifest" href='data:application/manifest+json,{"name":"ë¡œê·¸ë¦¿","short_name":"ë¡œê·¸ë¦¿","description":"ë§¤ì¶œì¥ë¶€ì™€ ìŠ¤ì¼€ì¤„ì„ í•˜ë‚˜ë¡œ í•©ì¹œ íš¨ìœ¨ì ì¸ ê´€ë¦¬ í”„ë¡œê·¸ë¨","start_url":"./index.html","display":"standalone","background_color":"#000000","theme_color":"#6366f1","icons":[{"src":"icon.png","sizes":"512x512","type":"image/png","purpose":"any maskable"}]}'>

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700;800;900&display=swap');
        
        :root {
            --bg-color: #000000;
            --card-bg: #111111;
            --text-main: #cbd5e1; 
            --text-bold: #ffffff;
            --border-color: #1e1e1e;
            --brand-color: #6366f1; 
            --calendar-border: rgba(203, 213, 225, 0.1); 
            --sun-color: #ff4d4d; 
            --sat-color: #4d94ff; 
            --badge-bg: rgba(255,255,255,0.05);
        }

        body.light-mode {
            --bg-color: #ffffff;
            --card-bg: #f8fafc;
            --text-main: #1e293b; 
            --text-bold: #000000; 
            --border-color: #e2e8f0;
            --brand-color: #4f46e5;
            --calendar-border: #e2e8f0;
            --sun-color: #dc2626;
            --sat-color: #2563eb;
            --badge-bg: #f1f5f9; 
        }

        body { 
            font-family: 'Pretendard', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-main);
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            overscroll-behavior-y: contain;
            letter-spacing: -0.05em; margin: 0; padding: 0;
            text-align: left;
        }

        span, p, h1, h2, h3, div, label, input, textarea { color: inherit; text-align: left; }
        .text-important { color: var(--text-bold) !important; }

        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); border-top: 0.5px solid var(--calendar-border); width: 100vw; margin: 0; }
        .memo-cell { min-height: 105px; background-color: var(--bg-color); display: flex; flex-direction: column; padding: 0; position: relative; cursor: pointer; border-right: 0.5px solid var(--calendar-border); border-bottom: 0.5px solid var(--calendar-border); overflow: hidden; transition: background-color 0.1s; }
        .memo-cell.is-selected { box-shadow: inset 0 0 0 2.5px var(--brand-color) !important; z-index: 10; }
        .memo-cell:nth-child(7n) { border-right: none; }
        
        .date-header { display: flex; flex-direction: column; align-items: center; width: 40px; margin-left: 0px; margin-top: 2px; position: relative; z-index: 2; height: 44px; }
        .date-num { font-size: 14px; font-weight: 700; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; position: relative; z-index: 3; color: var(--text-main); }
        
        .is-today .date-num { color: #ffffff !important; font-weight: 900; }
        .is-today .date-num::after {
            content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 26px; height: 26px; background-color: var(--brand-color); border-radius: 50%; z-index: -1;
            box-shadow: 0 0 12px rgba(99, 102, 241, 0.5);
        }

        .holiday-text { 
            font-size: 9px !important; font-weight: 800; padding: 1px 4px; border-radius: 4px;
            letter-spacing: -0.05em; margin-top: -4px; text-align: center; width: fit-content; 
            white-space: nowrap; line-height: 1.1; z-index: 4; display: inline-block;
        }
        .holiday-badge-red { background-color: rgba(255, 77, 77, 0.15); color: var(--sun-color) !important; }

        .sun { color: var(--sun-color) !important; }
        .sat { color: var(--sat-color) !important; }

        .memo-strip { width: 100%; font-size: 10px; padding: 1px 4px; margin-bottom: 2px; white-space: normal; word-break: break-all; font-weight: 600; line-height: 1.2; color: var(--text-main); margin-top: 1px; }
        .strip-time { font-weight: 800; color: var(--text-bold); margin-right: 2px; }

        .expansion-panel { grid-column: 1 / span 7; background-color: var(--card-bg); border-bottom: 1px solid var(--calendar-border); padding: 14px 16px; animation: slideDown 0.2s ease-out; scroll-margin-top: 80px; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .input-field { width: 100%; background-color: var(--bg-color); border: 1.5px solid var(--border-color); border-radius: 12px; padding: 0 16px; color: var(--text-bold) !important; outline: none; font-size: 16px; height: 54px; }
        .btn-primary { width: 100%; background-color: var(--brand-color); color: #ffffff !important; padding: 1.1rem; border-radius: 12px; font-weight: 800; }

        #btn-top { position: fixed; right: 20px; bottom: 175px; width: 52px; height: 52px; background-color: var(--card-bg); color: var(--text-bold); border: 1px solid var(--calendar-border); display: none; align-items: center; justify-content: center; z-index: 35; border-radius: 50%; box-shadow: 0 4px 15px rgba(0,0,0,0.15); }
        #btn-top.visible { display: flex; }
        .fab-add { position: fixed; right: 20px; bottom: 105px; width: 58px; height: 58px; background-color: var(--brand-color); color: white; border-radius: 20px; shadow: 0 6px 20px rgba(99, 102, 241, 0.4); display: flex; align-items: center; justify-content: center; z-index: 34; active:scale-90; transition: transform 0.1s; }

        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background-color: #1e293b; color: white; padding: 12px 24px; border-radius: 50px; font-size: 13px; font-weight: 600; z-index: 100; opacity: 0; visibility: hidden; transition: all 0.3s; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        #toast.visible { opacity: 1; visibility: visible; bottom: 100px; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-40 no-scrollbar text-left">

    <!-- ìƒë‹¨ ê³ ì • í—¤ë” -->
    <div class="fixed top-0 left-0 right-0 h-14 bg-black/95 backdrop-blur-xl flex items-center justify-between px-4 z-50 border-b border-white/5 light-mode:bg-white light-mode:border-slate-200">
        <div class="flex items-center gap-2">
            <div class="w-7 h-7 bg-indigo-600 flex items-center justify-center text-white font-black text-lg rounded-sm shadow-sm">L</div>
            <div class="flex flex-col">
                <span class="font-bold text-sm tracking-tighter text-important text-left">ë¡œê·¸ë¦¿</span>
                <span class="text-[7px] font-medium text-indigo-400 tracking-widest mt-0.5 uppercase text-left text-indigo-400">Master V140 Stable</span>
            </div>
        </div>
        <div class="flex items-center gap-2">
            <button onclick="toggleFullScreen()" class="w-8 h-8 bg-white/10 light-mode:bg-slate-100 rounded-lg flex items-center justify-center active:scale-90 transition-transform">
                <i data-lucide="maximize" class="w-4 h-4 text-important"></i>
            </button>
            <button onclick="goToToday()" class="px-3 h-8 bg-indigo-600 text-[11px] font-bold text-white rounded-lg flex items-center justify-center active:scale-90 transition-transform">
                ì˜¤ëŠ˜
            </button>
            <button onclick="openSettings()" class="w-8 h-8 flex items-center justify-center text-slate-400 light-mode:text-slate-500 active:scale-90 transition-transform">
                <i data-lucide="settings" class="w-5 h-5"></i>
            </button>
        </div>
    </div>

    <!-- ì•± ë©”ì¸ ë·° -->
    <div id="app-view" class="w-full mx-auto pt-14 px-0 overflow-x-hidden text-left"></div>

    <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav id="bottom-nav" class="fixed bottom-6 left-4 right-4 max-w-[calc(100%-2rem)] mx-auto bg-slate-800/95 backdrop-blur-xl border border-slate-700/50 h-20 flex justify-around items-center z-40 rounded-[2.5rem] shadow-2xl px-1 light-mode:bg-white/95 light-mode:border-slate-200">
        <button onclick="navTo('e_cal')" id="nav-e_cal" class="flex flex-col items-center gap-1 transition-all flex-1 text-slate-400"><i data-lucide="calendar" class="w-[18px] h-[18px]"></i><span class="text-[9px] font-bold text-left">ì¼ì •</span></button>
        <button onclick="navTo('list')" id="nav-list" class="flex flex-col items-center gap-1 transition-all flex-1 text-slate-400"><i data-lucide="clipboard-list" class="w-[18px] h-[18px]"></i><span class="text-[9px] font-bold text-left">ê¸°ë¡</span></button>
        <button onclick="navTo('s_cal')" id="nav-s_cal" class="flex flex-col items-center gap-1 transition-all flex-1 text-slate-400"><i data-lucide="trending-up" class="w-[18px] h-[18px]"></i><span class="text-[9px] font-bold text-left">ë§¤ì¶œ</span></button>
        <button onclick="navTo('home')" id="nav-home" class="flex flex-col items-center gap-1 transition-all flex-1 text-slate-400"><i data-lucide="layout-grid" class="w-[18px] h-[18px]"></i><span class="text-[9px] font-bold text-left">í™ˆ</span></button>
    </nav>

    <button id="btn-top" onclick="scrollToTop()"><i data-lucide="chevron-up" class="w-6 h-6 text-important"></i></button>
    <button onclick="openEntryModal()" class="fab-add shadow-indigo-500/40 shadow-xl"><i data-lucide="plus" class="w-8 h-8 text-white"></i></button>

    <div id="toast">ì•Œë¦¼</div>

    <script>
        const STORAGE_KEY = 'logrit_v130_master_storage';
        let db = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        let isLightMode = JSON.parse(localStorage.getItem('theme_is_light') || 'false');
        
        let currentNav = 'e_cal', currentEditId = null, calContext = new Date(), selectedDate = null;
        let startX = 0, startY = 0, searchTerm = "";

        const monthNamesEn = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        
        window.onload = () => { applyTheme(); render(); lucide.createIcons(); window.addEventListener('scroll', handleScroll); };
        function sync() { localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); render(); lucide.createIcons(); }
        function formatKRW(val) { return new Intl.NumberFormat('ko-KR').format(Number(val) || 0); }
        window.handleAmountInput = (el) => { let v = el.value.replace(/[^0-9]/g, ''); el.value = v ? Number(v).toLocaleString() : ''; };
        function formatTimeDisplay(timeStr) { if(!timeStr) return ''; const parts = timeStr.split(':'); return (parts.length === 2 && (parts[1] === '00' || parts[1] === '0')) ? `${parseInt(parts[0])}ì‹œ` : timeStr; }
        const sortItemsByDateAsc = (items) => [...items].sort((a, b) => a.date.localeCompare(b.date) || (a.time || '99:99').localeCompare(b.time || '99:99'));
        const sortItemsByTime = (items) => [...items].sort((a, b) => (a.time || '99:99').localeCompare(b.time || '99:99'));
        function autoResize(textarea) { textarea.style.height = 'auto'; textarea.style.height = textarea.scrollHeight + 'px'; }
        function autoFormatTime(el) { let val = el.value.replace(/[^0-9]/g, ''); if (val.length >= 3) el.value = val.slice(0, 2) + ':' + val.slice(2, 4); else el.value = val; }
        function handleScroll() { const btn = document.getElementById('btn-top'); if (window.scrollY > 400) btn.classList.add('visible'); else btn.classList.remove('visible'); }
        window.scrollToTop = () => window.scrollTo({ top: 0, behavior: 'smooth' });
        function getLocalToday() { const now = new Date(); return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`; }
        function applyTheme() { const body = document.body; if(isLightMode) body.classList.add('light-mode'); else body.classList.remove('light-mode'); localStorage.setItem('theme_is_light', JSON.stringify(isLightMode)); }
        window.showToast = (msg) => { const t = document.getElementById('toast'); t.innerText = msg; t.classList.add('visible'); setTimeout(() => t.classList.remove('visible'), 2500); };
        window.toggleFullScreen = () => { if (!document.fullscreenElement) { document.documentElement.requestFullscreen().catch(() => showToast("ì „ì²´í™”ë©´ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.")); } else { document.exitFullscreen(); } };
        window.toggleTheme = () => { isLightMode = !isLightMode; applyTheme(); render(); };
        window.navTo = (nav) => { currentNav = nav; selectedDate = null; searchTerm = ""; render(); };
        
        window.moveMonth = (v) => { 
            const newDate = new Date(calContext.getFullYear(), calContext.getMonth() + v, 1);
            calContext = newDate;
            selectedDate = null; 
            render(); 
        };

        window.goToToday = () => { calContext = new Date(); selectedDate = null; currentNav = 'e_cal'; render(); window.scrollTo({ top: 0, behavior: 'smooth' }); };
        window.openSettings = () => { currentNav = 'settings'; render(); };
        window.handleDateTouch = (dateStr) => { if (selectedDate === dateStr) { selectedDate = null; render(); } else { selectedDate = dateStr; render(); setTimeout(() => { const panel = document.querySelector('.expansion-panel'); if (panel) panel.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 100); } };
        window.handleTouchStart = (e) => { startX = e.touches[0].clientX; startY = e.touches[0].clientY; };
        window.handleTouchEnd = (e) => { const diffX = startX - e.changedTouches[0].clientX; const diffY = startY - e.changedTouches[0].clientY; if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 60) { if (diffX > 0) moveMonth(1); else moveMonth(-1); } };

        function renderItemCard(item, showDate = false, hideAmount = false) {
            return `
                <div onclick="openEntryModal('${item.id}')" class="bg-card py-3 px-4 rounded-[1.25rem] border border-white/5 light-mode:border-slate-200 light-mode:bg-white mb-2 active:opacity-60 text-left shadow-sm">
                    <div class="flex justify-between items-center pb-1.5 mb-1.5 border-b border-white/5 light-mode:border-slate-100 opacity-80 text-important text-left">
                        <div class="flex items-center gap-2 text-indigo-500 font-bold text-[12px] uppercase text-left text-indigo-500">
                            ${showDate ? `<span class="px-2 py-0.5 rounded bg-indigo-500/10 text-left text-indigo-500">${item.date.split('-').slice(1).join('.')}</span>` : ''}
                            <span class="font-mono text-important text-left text-[12px]">${formatTimeDisplay(item.time) || '--ì‹œ'}</span>
                        </div>
                        <i data-lucide="chevron-right" class="w-3.5 h-3.5 opacity-40 text-important"></i>
                    </div>
                    <div class="space-y-2 text-left">
                        <p class="text-[18px] font-bold text-important leading-tight text-left text-important">${item.note || 'ë‚´ìš© ì—†ìŒ'}</p>
                        ${(item.departure || item.arrival) ? `<div class="text-[13px] font-bold bg-[var(--badge-bg)] py-1.5 px-3 rounded-lg border border-white/5 light-mode:border-slate-300 text-important text-left text-important"><span class="flex items-center gap-2 text-left">${item.departure || '..'} <i data-lucide="arrow-right" class="w-3 h-3 opacity-50 text-left"></i> ${item.arrival || '..'}</span></div>` : ''}
                        <div class="flex justify-between items-center pt-0.5 text-left text-important">
                            <div class="flex items-center gap-1.5 text-[12px] font-bold text-left text-important">
                                ${(item.people > 0) ? `<span class="text-indigo-500 text-left text-indigo-500">ì¸ì›: ${item.people}ëª…</span>` : ''}
                                ${(item.people > 0 && item.supplier) ? `<span class="text-slate-400 opacity-50 text-left">â€¢</span>` : ''}
                                <span class="text-slate-500 uppercase tracking-tighter text-left text-slate-500">${item.supplier || 'ë¯¸ì§€ì •'}</span>
                            </div>
                            ${(!hideAmount && item.amount > 0) ? `<p class="text-[20px] font-black text-important tracking-tighter text-right text-important text-left">ğŸ’° ${formatKRW(item.amount)}ì›</p>` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        function render() {
            const root = document.getElementById('app-view'), navs = ['e_cal', 'list', 's_cal', 'home'];
            navs.forEach(id => { const btn = document.getElementById('nav-' + id); if(btn) { if(currentNav === id) { btn.classList.add('text-indigo-500', 'scale-110'); btn.classList.remove('text-slate-400'); } else { btn.classList.remove('text-indigo-500', 'scale-110'); btn.classList.add('text-slate-400'); } } });
            const monthPrefix = `${calContext.getFullYear()}-${String(calContext.getMonth()+1).padStart(2,'0')}`, todayStr = getLocalToday();

            if(currentNav === 'home') {
                const todayItems = sortItemsByTime(db.filter(x => x.date === todayStr)), monthTotal = db.filter(x => x.date.startsWith(monthPrefix)).reduce((acc, cur) => acc + (Number(cur.amount) || 0), 0);
                root.innerHTML = `<div class="animate-in fade-in duration-500 px-5 pt-4 text-important text-left text-left text-important"><div class="bg-gradient-to-br from-indigo-950/20 to-zinc-900/50 light-mode:from-indigo-50 light-mode:to-white p-8 mb-8 border border-indigo-500/10 light-mode:border-indigo-200 shadow-2xl rounded-[2rem] text-left text-important"><p class="opacity-50 text-[11px] uppercase tracking-[0.2em] mb-1 text-left">Monthly Total Rev</p><h2 class="text-5xl font-black tracking-tighter text-important text-left text-important text-important">${formatKRW(monthTotal)}<span class="text-xl ml-1 opacity-40 font-light text-important">ì›</span></h2><div class="mt-8 flex flex-col text-left text-important"><span class="text-[11px] opacity-40 uppercase tracking-widest text-left text-important">ì˜¤ëŠ˜ ì¼ì •</span><span class="text-3xl font-black text-indigo-500 text-left text-indigo-500">${todayItems.length}ê±´</span></div></div><h3 class="opacity-40 text-[11px] uppercase px-1 mb-4 tracking-[0.3em] text-left text-important">Today's Activity</h3>${todayItems.map(it => renderItemCard(it, false, true)).join('') || '<p class="text-center py-20 opacity-30 text-sm italic text-left text-important text-important">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}</div>`;
            } else if(currentNav === 'list') {
                const filtered = sortItemsByDateAsc(db.filter(it => (it.note||'').toLowerCase().includes(searchTerm) || (it.supplier||'').toLowerCase().includes(searchTerm)));
                root.innerHTML = `<div class="animate-in fade-in duration-500 px-5 text-important text-left text-left text-important text-important"><div class="py-4 text-left text-important"><input type="text" placeholder="ê²€ìƒ‰..." class="input-field w-full shadow-inner text-left text-important text-important" value="${searchTerm}" oninput="searchTerm=this.value.toLowerCase(); render();"></div><h1 class="text-xl font-black mb-5 text-left text-important text-left">ì „ì²´ ê¸°ë¡</h1>${filtered.map(x => renderItemCard(x, true, false)).join('') || `<p class="text-center py-24 opacity-30 italic text-left text-important text-important">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>`}</div>`;
            } else if(currentNav === 's_cal') { 
                const mData = db.filter(x => x.date.startsWith(monthPrefix) && Number(x.amount) > 0), total = mData.reduce((a,b) => a + (Number(b.amount) || 0), 0), bySupp = mData.reduce((acc, c) => { const n = c.supplier || 'ë¯¸ì§€ì •'; acc[n] = (acc[n]||0) + Number(c.amount); return acc; }, {});
                root.innerHTML = `<div class="animate-in fade-in duration-500 px-5 pt-4 text-important text-left text-left text-important text-important text-important text-important"><div class="flex flex-col mb-10 text-left text-important text-important text-important"><h2 class="text-2xl font-black text-important text-left text-important text-important text-important">${calContext.getMonth() + 1}ì›” ë§¤ì¶œ í†µê³„</h2><p class="text-[11px] opacity-40 uppercase tracking-[0.4em] mt-1 text-important text-left text-left text-important text-important text-important">${calContext.getFullYear()}</p></div><div class="grid grid-cols-2 gap-4 mb-12 text-left text-important text-important"><div class="p-6 bg-zinc-900/50 light-mode:bg-slate-50 border border-white/5 light-mode:border-slate-200 rounded-3xl shadow-lg text-left text-important text-important"><p class="text-[10px] opacity-50 uppercase font-bold mb-1 text-left text-important text-important">Total Rev</p><p class="text-lg font-black text-indigo-500 text-left text-left text-important text-important text-important">${formatKRW(total)}ì›</p></div><div class="p-6 bg-zinc-900/50 light-mode:bg-slate-50 border border-white/5 light-mode:border-slate-200 rounded-3xl shadow-lg text-left text-left text-important text-important text-important"><p class="text-[10px] opacity-50 uppercase font-bold mb-1 text-left text-left text-left text-left text-important text-important text-important">Count</p><p class="text-lg font-black text-important text-left text-left text-left text-left text-important text-important text-important">${mData.length}ê±´</p></div></div><h3 class="text-[11px] opacity-40 uppercase font-bold mb-4 px-1 tracking-widest text-important text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important">ê±°ë˜ì²˜ë³„ í•©ê³„</h3><div class="bg-zinc-950 light-mode:bg-white border border-white/5 light-mode:border-slate-200 overflow-hidden rounded-3xl text-left text-important text-important text-important">${Object.entries(bySupp).sort((a,b)=>b[1]-a[1]).map(([n, v]) => `<div onclick="navTo('list'); searchTerm='${n.toLowerCase()}'; render();" class="flex justify-between items-center p-5 border-b border-white/5 light-mode:border-slate-100 active:bg-indigo-500/10 text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important"><span class="font-bold text-[14px] text-important text-left text-left text-important text-important text-important text-important text-important">${n}</span><span class="font-black text-indigo-400 text-[16px] text-left text-left text-important text-important text-important text-important text-important">${formatKRW(v)}ì›</span></div>`).join('') || '<p class="p-16 text-center opacity-30 text-sm text-left text-important text-important text-important text-important text-important text-important text-important text-important">ë‚´ì—­ ì—†ìŒ</p>'}</div></div>`;
            } else if(currentNav === 'settings') {
                root.innerHTML = `<div class="animate-in fade-in duration-500 px-6 pt-6 text-important text-left text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important"><h2 class="text-2xl font-black mb-8 text-left text-left text-important text-important text-important text-important text-important">ì‹œìŠ¤í…œ ì„¤ì •</h2><div class="space-y-6 text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important"><div class="flex justify-between items-center bg-white/5 light-mode:bg-slate-100 p-5 rounded-2xl text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important"><span class="font-bold text-left text-important text-left text-important text-important text-important text-important text-important text-important text-important text-important">í™”ì´íŠ¸ ëª¨ë“œ</span><button onclick="toggleTheme()" class="w-12 h-6 bg-zinc-700 light-mode:bg-slate-300 rounded-full relative transition-colors text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important"><div class="w-4 h-4 bg-white rounded-full absolute top-1 left-1 text-important text-important text-important text-important text-important" style="${isLightMode?'transform:translateX(24px)':''}"></div></button></div><div class="pt-6 border-t border-white/10 light-mode:border-slate-200 space-y-4 text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important"><p class="text-[10px] font-bold text-indigo-500 uppercase tracking-widest text-center text-left text-left text-important text-important text-important text-important text-important text-important text-important">Data Storage</p><button onclick="window.exportData()" class="w-full py-4 bg-zinc-800 light-mode:bg-slate-100 rounded-xl text-xs font-bold text-important flex items-center justify-center gap-2 text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important"><i data-lucide="download" class="w-4 h-4 text-left text-important text-important text-important text-important text-important"></i> ë°±ì—… íŒŒì¼ ë§Œë“¤ê¸°</button><button onclick="document.getElementById('f-load').click()" class="w-full py-4 bg-zinc-700 light-mode:bg-slate-200 rounded-xl text-xs font-bold text-important flex items-center justify-center gap-2 text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important"><i data-lucide="upload" class="w-4 h-4 text-left text-important text-important text-important text-important text-important text-important"></i> ë°±ì—… ë¶ˆëŸ¬ì˜¤ê¸°</button><input type="file" id="f-load" class="hidden" accept=".json" onchange="window.importFile(event)"><button onclick="if(confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí• ê¹Œìš”?')){db=[];sync();navTo('home');}" class="w-full py-2 text-[10px] text-red-500 opacity-60 text-center text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important">ì „ì²´ ë°ì´í„° ì´ˆê¸°í™”</button></div></div></div>`;
            } else if(currentNav === 'e_cal') {
                const y = calContext.getFullYear(), m = calContext.getMonth(), start = new Date(y, m, 1).getDay(), last = new Date(y, m + 1, 0).getDate();
                let gridHtml = '', cells = [];
                for(let i = 0; i < (Math.ceil((start + last) / 7) * 7); i++) {
                    const dNum = i - start + 1, isV = dNum > 0 && dNum <= last, mm = String(m + 1).padStart(2, '0'), dd = String(dNum).padStart(2, '0'), dateStr = isV ? `${y}-${mm}-${dd}` : null, isT = isV && getLocalToday() === dateStr;
                    if (isV) {
                        const items = sortItemsByTime(db.filter(x => x.date === dateStr));
                        let strips = items.map(it => `<div class="memo-strip text-important text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important"><span class="strip-time text-important text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important">${formatTimeDisplay(it.time)}</span> ${it.supplier ? it.supplier + ' ' : ''}${it.departure || it.note.substring(0,8)}</div>`).join('');
                        const holiday = (y === 2026) ? { "01-01": "ì‹ ì •", "02-16": "ì„¤ë‚ ", "02-17": "ì„¤ë‚ ", "02-18": "ì„¤ë‚ ", "03-01": "ì‚¼ì¼ì ˆ", "05-05": "ì–´ë¦°ì´ë‚ ", "05-24": "ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ", "06-06": "í˜„ì¶©ì¼", "08-15": "ê´‘ë³µì ˆ", "09-24": "ì¶”ì„", "09-25": "ì¶”ì„", "09-26": "ì¶”ì„", "10-03": "ê°œì²œì ˆ", "10-09": "í•œê¸€ë‚ ", "12-25": "ì„±íƒ„ì ˆ" }[`${mm}-${dd}`] : null;
                        const dColor = (i % 7 === 0 || holiday) ? 'sun' : (i % 7 === 6 ? 'sat' : '');
                        const holidayHtml = holiday ? `<span class="holiday-text holiday-badge-red text-center text-important text-important text-important text-important text-important text-important text-important text-important">${holiday}</span>` : '';
                        cells.push(`<div onclick="handleDateTouch('${dateStr}')" class="memo-cell ${isT ? 'is-today' : ''} ${selectedDate === dateStr ? 'is-selected' : ''} text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important"><div class="date-header text-left text-left text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important"><span class="date-num ${dColor} text-left text-left text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important">${dNum}</span>${holidayHtml}</div><div class="w-full text-left text-left text-left text-left text-left text-left text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important">${strips}</div></div>`);
                    } else cells.push(`<div class="memo-cell opacity-5 text-left text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important"></div>`);
                    if ((i + 1) % 7 === 0) {
                        gridHtml += cells.join('');
                        if (selectedDate) {
                            const daily = sortItemsByTime(db.filter(x => x.date === selectedDate)), dow = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][new Date(selectedDate).getDay()], parts = selectedDate.split('-');
                            if (parseInt(parts[0]) === y && parseInt(parts[1]) === m + 1 && (parseInt(parts[2]) + start - 1) >= i - 6 && (parseInt(parts[2]) + start - 1) <= i) {
                                gridHtml += `<div class="expansion-panel text-left text-left text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important"><div class="flex justify-between items-center mb-5 border-b border-white/5 light-mode:border-slate-300 pb-3 text-important text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important"><span class="text-[16px] font-black tracking-widest uppercase text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important">${parts[1]}.${parts[2]} (${dow}) ìƒì„¸ ì¼ì •</span><button onclick="handleDateTouch(null); event.stopPropagation(); text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important"><i data-lucide="x" class="w-6 h-6 text-important text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important"></i></button></div><div class="space-y-2.5 text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important">${daily.map(it => renderItemCard(it, false, true)).join('') || '<p class="text-center py-10 text-slate-600 text-xs italic text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}</div></div>`;
                            }
                        }
                        cells = [];
                    }
                }
                
                root.innerHTML = `
                    <div ontouchstart="handleTouchStart(event)" ontouchend="handleTouchEnd(event)" class="animate-in fade-in duration-500 text-left px-0 text-important text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important">
                        <div class="flex justify-between items-end mb-6 px-5 text-left text-important text-important text-important text-important text-important text-important text-important">
                            <div class="flex items-end gap-3 text-left text-important text-important text-important text-important text-important text-important text-important text-important">
                                <h2 class="text-3xl font-black tracking-tighter leading-none text-important text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important"> ${m + 1}ì›”</h2>
                                <div class="flex flex-col mb-1 text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important">
                                    <span class="text-[10px] font-bold opacity-50 uppercase tracking-widest leading-none mb-1 text-important text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important">${y}</span>
                                    <span class="text-sm font-medium opacity-50 italic leading-none text-important text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important">${monthNamesEn[m]}</span>
                                </div>
                            </div>
                            <!-- ë‹¬ë ¥ ì´ë™ ë²„íŠ¼ ì •ë°€ ë¯¸ì„¸ ì¡°ì • (V140) -->
                            <div class="flex gap-1 bg-card p-0.5 rounded-lg border border-white/10 shadow-sm light-mode:bg-slate-100 light-mode:border-slate-200 text-important mb-0.5 translate-y-[6px]">
                                <button onclick="moveMonth(-1)" class="p-1 active:bg-indigo-500/10 rounded-md text-important transition-all text-important text-important text-important"><i data-lucide="chevron-left" class="w-3.5 h-3.5 text-important text-important"></i></button>
                                <button onclick="moveMonth(1)" class="p-1 active:bg-indigo-500/10 rounded-md text-important transition-all text-important text-important text-important text-important"><i data-lucide="chevron-right" class="w-3.5 h-3.5 text-important text-important text-important"></i></button>
                            </div>
                        </div>
                        <div class="grid grid-cols-7 text-[13px] font-extrabold text-center mb-4 opacity-50 text-important text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important">
                            <div class="text-center text-important text-important text-important text-important text-important text-important">SUN</div><div class="text-center text-important text-important text-important text-important text-important text-important">MON</div><div class="text-center text-important text-important text-important text-important text-important text-important">TUE</div><div class="text-center text-important text-important text-important text-important text-important text-important text-important text-important">WED</div><div class="text-center text-important text-important text-important text-important text-important text-important text-important text-important">THU</div><div class="text-center text-important text-important text-important text-important text-important text-important text-important text-important">FRI</div><div class="text-center text-important text-important text-important text-important text-important text-important text-important text-important">SAT</div>
                        </div>
                        <div class="calendar-grid border-b border-white/5 light-mode:border-slate-200 shadow-2xl text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important">${gridHtml}</div>
                    </div>
                `;
            }
            lucide.createIcons();
        }

        window.openEntryModal = (id = null) => {
            currentEditId = id ? String(id) : null;
            const modal = document.getElementById('entry-modal'), noteArea = document.getElementById('f-note');
            modal.classList.remove('hidden');
            if(currentEditId) {
                const it = db.find(x => String(x.id) === currentEditId);
                if(it) {
                    document.getElementById('f-date').value = it.date; document.getElementById('f-supplier').value = it.supplier || ""; 
                    document.getElementById('f-amount-display').value = it.amount ? Number(it.amount).toLocaleString() : '';
                    noteArea.value = it.note || ''; document.getElementById('f-time').value = it.time || ''; document.getElementById('f-departure').value = it.departure || ''; document.getElementById('f-arrival').value = it.arrival || ''; document.getElementById('f-people').value = it.people || ''; document.getElementById('delete-btn').classList.remove('hidden');
                }
                setTimeout(() => autoResize(noteArea), 50);
            } else {
                document.getElementById('record-form').reset(); document.getElementById('f-date').value = selectedDate || getLocalToday(); document.getElementById('delete-btn').classList.add('hidden'); noteArea.style.height = 'auto';
            }
        };
        window.closeEntryModal = () => document.getElementById('entry-modal').classList.add('hidden');
        document.getElementById('record-form').onsubmit = (e) => {
            e.preventDefault();
            const rawAmount = document.getElementById('f-amount-display').value.replace(/[^0-9]/g, '');
            const record = { id: currentEditId || String(Date.now()), date: document.getElementById('f-date').value, amount: parseInt(rawAmount || 0), supplier: document.getElementById('f-supplier').value || "ë¯¸ì§€ì •", note: document.getElementById('f-note').value, time: document.getElementById('f-time').value, departure: document.getElementById('f-departure').value, arrival: document.getElementById('f-arrival').value, people: parseInt(document.getElementById('f-people').value || 0), updatedAt: Date.now() };
            if(currentEditId) db = db.map(x => String(x.id) === currentEditId ? record : x); else db.push(record); sync(); closeEntryModal();
        };
        window.deleteItemDirect = () => { if(currentEditId && confirm('ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?')) { db = db.filter(x => String(x.id) !== currentEditId); sync(); closeEntryModal(); } };
        
        window.exportData = () => {
            const dataStr = JSON.stringify(db, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `logrit_backup_${getLocalToday()}.json`;
            link.click();
            URL.revokeObjectURL(url);
            showToast("âœ… ë°±ì—… íŒŒì¼ ìƒì„± ì™„ë£Œ");
        };

        window.importFile = (event) => {
            const file = event.target.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const imported = JSON.parse(e.target.result);
                    if(confirm('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ? ê¸°ì¡´ ë°ì´í„°ê°€ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤.')) {
                        db = Array.isArray(imported) ? imported : (imported.records || []);
                        sync(); showToast("ğŸ“Š ë°ì´í„° ë³µêµ¬ ì™„ë£Œ!"); navTo('home');
                    }
                } catch(err) { showToast("âŒ ì˜ëª»ëœ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤."); }
            };
            reader.readAsText(file);
        };
    </script>

    <!-- ì…ë ¥ ëª¨ë‹¬ -->
    <div id="entry-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 hidden flex items-end text-left text-important">
        <div class="bg-zinc-900 w-full max-w-md mx-auto rounded-t-3xl p-6 slide-up pb-12 overflow-y-auto max-h-[90vh] light-mode:bg-white text-left text-important">
            <div class="flex justify-between items-center mb-6 text-left text-important">
                <h3 class="text-xl font-bold text-important text-left text-left text-important text-important text-important">í™œë™ ê¸°ë¡</h3>
                <button onclick="closeEntryModal()" class="p-2 bg-zinc-800 light-mode:bg-slate-100 rounded-full text-slate-400 text-left text-left text-important text-important text-important text-important"><i data-lucide="x" class="w-5 h-5 text-left text-left text-important text-important text-important text-important text-important"></i></button>
            </div>
            <form id="record-form" class="space-y-4 text-left text-important text-important text-important">
                <input type="date" id="f-date" class="input-field text-left text-important text-important text-important text-important" required>
                <div class="grid grid-cols-2 gap-3 text-left text-important text-important text-important text-important text-important"><input type="text" id="f-departure" placeholder="ì¶œë°œì§€" class="input-field font-bold text-left text-important text-important text-important text-important text-important text-important"><input type="text" id="f-arrival" placeholder="ë„ì°©ì§€" class="input-field font-bold text-left text-important text-important text-important text-important text-important text-important text-important"></div>
                <div class="grid grid-cols-2 gap-3 text-left text-important text-important text-important text-important text-important text-important"><input type="text" id="f-time" placeholder="ì‹œê°„ (HHMM)" maxlength="5" inputmode="numeric" oninput="autoFormatTime(this)" class="input-field font-mono text-center text-lg text-left text-important text-important text-important text-important text-important text-important text-important"><input type="number" id="f-people" placeholder="ëª…" class="input-field font-bold text-left text-important text-important text-important text-important text-important text-important text-important text-important"></div>
                <input type="text" id="f-supplier" placeholder="ê±°ë˜ì²˜ëª…" class="input-field font-bold text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important">
                <div class="relative w-full text-left text-important text-important text-important text-important text-important text-important text-important text-important">
                    <input type="text" id="f-amount-display" placeholder="ë§¤ì¶œ ê¸ˆì•¡" inputmode="numeric" oninput="handleAmountInput(this)" class="input-field font-bold text-xl pr-10 text-left text-important text-important text-important text-important text-important text-important text-important text-important">
                    <span class="absolute right-4 top-1/2 -translate-y-1/2 opacity-60 font-bold text-important text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important">ì›</span>
                </div>
                <textarea id="f-note" placeholder="ìƒì„¸ ë©”ëª¨" class="input-field h-auto min-h-[120px] p-4 leading-relaxed text-left text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important" oninput="autoResize(this)"></textarea>
                <div class="flex gap-3 mt-6 text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important text-important">
                    <button type="button" id="delete-btn" onclick="deleteItemDirect()" class="hidden flex-1 bg-red-950/20 light-mode:bg-red-50 text-red-500 py-4 border border-red-900/20 rounded-xl font-bold text-center text-left text-important text-important text-important text-important">ì‚­ì œ</button>
                    <button type="submit" class="flex-[2] btn-primary text-center text-left text-important text-important text-important text-important text-important text-important text-important text-important text-important">ê¸°ë¡ ì €ì¥í•˜ê¸°</button>
                </div>
            </form>
        </div>
    </div>
</body>
</html>

