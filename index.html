<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>로그릿</title>
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700;800;900&display=swap');
        
        :root {
            --bg-color: #000000;
            --card-bg: #111111;
            --text-main: #cbd5e1; 
            --text-bold: #ffffff;
            --brand-color: #6366f1; 
            --calendar-border: rgba(203, 213, 225, 0.1); 
            --sun-color: #ff4d4d; 
            --sat-color: #4d94ff; 
        }

        body.light-mode {
            --bg-color: #ffffff;
            --card-bg: #f8fafc;
            --text-main: #1e293b; 
            --text-bold: #000000; 
            --brand-color: #4f46e5;
            --calendar-border: #e2e8f0;
        }

        body { 
            font-family: 'Pretendard', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-main);
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            overscroll-behavior-y: contain;
            letter-spacing: -0.05em; margin: 0; padding: 0;
            text-align: left;
        }

        .text-important { color: var(--text-bold) !important; }

        /* 로고 박스 스타일 */
        .logo-box { width: 32px; height: 32px; background: var(--brand-color); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 900; color: white; margin-right: 10px; font-size: 18px; }

        /* 달력 그리드 */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); border-top: 0.5px solid var(--calendar-border); width: 100vw; }
        .memo-cell { min-height: 105px; border-right: 0.5px solid var(--calendar-border); border-bottom: 0.5px solid var(--calendar-border); position: relative; cursor: pointer; display: flex; flex-direction: column; overflow: hidden; }
        .memo-cell.is-selected { box-shadow: inset 0 0 0 2px var(--brand-color); z-index: 10; }
        .memo-cell:nth-child(7n) { border-right: none; }
        
        .date-num { font-size: 14px; font-weight: 700; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; margin: 2px auto; }
        .is-today .date-num { background: var(--brand-color); color: white; border-radius: 50%; }

        .memo-strip { font-size: 9px; padding: 1px 4px; background: rgba(255,255,255,0.05); border-radius: 3px; margin: 1px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .sun { color: var(--sun-color) !important; }
        .sat { color: var(--sat-color) !important; }

        .expansion-panel { grid-column: 1 / span 7; background-color: var(--card-bg); border-bottom: 1px solid var(--calendar-border); padding: 14px 16px; }

        .input-field { width: 100%; background-color: rgba(255,255,255,0.05); border: 1px solid var(--border-color); border-radius: 12px; padding: 14px; color: var(--text-bold); outline: none; }
        .btn-primary { background-color: var(--brand-color); color: white; padding: 14px; border-radius: 12px; font-weight: 800; width: 100%; }

        #toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #1e293b; color: white; padding: 12px 24px; border-radius: 50px; font-size: 13px; z-index: 1000; opacity: 0; visibility: hidden; transition: 0.3s; }
        #toast.visible { opacity: 1; visibility: visible; }
    </style>
</head>
<body class="pb-32 no-scrollbar">

    <!-- 헤더 (L 아이콘 복구, 전체화면 삭제) -->
    <div class="fixed top-0 left-0 right-0 h-14 bg-black/95 backdrop-blur-xl flex items-center justify-between px-4 z-50 border-b border-white/5 light-mode:bg-white light-mode:border-slate-200">
        <div class="flex items-center">
            <div class="logo-box">L</div>
            <div class="flex flex-col">
                <span class="font-bold text-sm text-important">로그릿</span>
                <span class="text-[7px] font-medium text-indigo-400 tracking-widest uppercase">Master V152 Official</span>
            </div>
        </div>
        <div class="flex items-center gap-2">
            <button onclick="goToToday()" class="px-3 h-8 bg-indigo-600 text-[11px] font-bold text-white rounded-lg active:scale-95">오늘</button>
            <button onclick="openSettings()" class="w-8 h-8 flex items-center justify-center text-slate-400 active:scale-95"><i data-lucide="settings" class="w-5 h-5"></i></button>
        </div>
    </div>

    <!-- 앱 뷰 -->
    <div id="app-view" class="pt-14 overflow-x-hidden"></div>

    <!-- 하단 메뉴 -->
    <nav class="fixed bottom-6 left-4 right-4 bg-zinc-900/90 backdrop-blur-lg border border-white/10 h-16 flex justify-around items-center z-40 rounded-2xl shadow-2xl light-mode:bg-white/95 light-mode:border-slate-200">
        <button onclick="navTo('e_cal')" id="nav-e_cal" class="flex flex-col items-center gap-1 flex-1 text-slate-400"><i data-lucide="calendar" class="w-5 h-5"></i><span class="text-[9px] font-bold">일정</span></button>
        <button onclick="navTo('list')" id="nav-list" class="flex flex-col items-center gap-1 flex-1 text-slate-400"><i data-lucide="clipboard-list" class="w-5 h-5"></i><span class="text-[9px] font-bold">기록</span></button>
        <button onclick="navTo('s_cal')" id="nav-s_cal" class="flex flex-col items-center gap-1 flex-1 text-slate-400"><i data-lucide="trending-up" class="w-5 h-5"></i><span class="text-[9px] font-bold">매출</span></button>
        <button onclick="navTo('home')" id="nav-home" class="flex flex-col items-center gap-1 flex-1 text-slate-400"><i data-lucide="layout-grid" class="w-5 h-5"></i><span class="text-[9px] font-bold">홈</span></button>
    </nav>

    <!-- 추가 버튼 -->
    <button onclick="openEntryModal()" class="fixed right-6 bottom-24 w-14 h-14 bg-indigo-600 text-white rounded-2xl shadow-xl flex items-center justify-center z-40 active:scale-90 transition-transform"><i data-lucide="plus" class="w-7 h-7"></i></button>

    <div id="toast"></div>

    <script>
        const STORAGE_KEY = 'logrit_v130_master_storage';
        let db = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        let isLightMode = JSON.parse(localStorage.getItem('theme_is_light') || 'false');
        let currentNav = 'e_cal', calContext = new Date(), selectedDate = null, searchTerm = "";

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => { navigator.serviceWorker.register('sw.js'); });
        }

        window.onload = () => { applyTheme(); render(); lucide.createIcons(); };
        function sync() { localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); render(); lucide.createIcons(); }
        function applyTheme() { document.body.classList.toggle('light-mode', isLightMode); }
        function showToast(m) { const t = document.getElementById('toast'); t.innerText = m; t.classList.add('visible'); setTimeout(()=>t.classList.remove('visible'), 2000); }
        function formatKRW(v) { return new Intl.NumberFormat('ko-KR').format(v || 0); }
        window.navTo = (n) => { currentNav = n; render(); };
        window.openSettings = () => { currentNav = 'settings'; render(); };
        window.moveMonth = (v) => { calContext = new Date(calContext.getFullYear(), calContext.getMonth() + v, 1); selectedDate = null; render(); };
        window.goToToday = () => { calContext = new Date(); currentNav = 'e_cal'; render(); };
        window.handleDateTouch = (d) => { if(selectedDate===d) selectedDate=null; else selectedDate=d; render(); };

        function render() {
            const root = document.getElementById('app-view');
            ['e_cal', 'list', 's_cal', 'home'].forEach(id => {
                const el = document.getElementById('nav-' + id);
                if(el) el.style.color = currentNav === id ? '#6366f1' : '#64748b';
            });

            if(currentNav === 'e_cal') renderCalendar(root);
            else if(currentNav === 'list') renderList(root);
            else if(currentNav === 's_cal') renderSales(root);
            else if(currentNav === 'home') renderHome(root);
            else if(currentNav === 'settings') renderSettings(root);
            lucide.createIcons();
        }

        function renderCalendar(root) {
            const y = calContext.getFullYear(), m = calContext.getMonth();
            const start = new Date(y, m, 1).getDay(), last = new Date(y, m + 1, 0).getDate();
            const todayStr = new Date().toISOString().split('T')[0];

            let html = `<div class="px-5 py-4"><h2 class="text-2xl font-black text-important">${m+1}월</h2><p class="text-[10px] font-bold opacity-40 uppercase tracking-widest">${y}</p></div>`;
            html += `<div class="grid grid-cols-7 text-center text-[10px] font-bold opacity-40 mb-2"><div>SUN</div><div>MON</div><div>TUE</div><div>WED</div><div>THU</div><div>FRI</div><div>SAT</div></div>`;
            html += `<div class="calendar-grid">`;
            
            for(let i=0; i<start; i++) html += `<div class="memo-cell opacity-5"></div>`;
            for(let d=1; d<=last; d++) {
                const dateStr = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const items = db.filter(x => x.date === dateStr);
                const isToday = dateStr === todayStr;
                const dColor = (new Date(dateStr).getDay() === 0) ? 'sun' : (new Date(dateStr).getDay() === 6 ? 'sat' : '');
                html += `
                    <div onclick="handleDateTouch('${dateStr}')" class="memo-cell ${isToday?'is-today':''} ${selectedDate===dateStr?'is-selected':''}">
                        <div class="date-num ${dColor}">${d}</div>
                        ${items.map(it => `<div class="memo-strip">${it.supplier || it.note}</div>`).join('')}
                    </div>`;
                if(selectedDate === dateStr && (start+d)%7===0 || d===last) {
                    // 패널 로직 생략 가능하나 안정성을 위해 빈공간 확보
                }
            }
            html += `</div><div class="flex justify-center gap-1 mt-10 mb-20">
                <button onclick="moveMonth(-1)" class="p-3 bg-zinc-900 light-mode:bg-slate-100 rounded-xl"><i data-lucide="chevron-left" class="w-5 h-5"></i></button>
                <button onclick="moveMonth(1)" class="p-3 bg-zinc-900 light-mode:bg-slate-100 rounded-xl"><i data-lucide="chevron-right" class="w-5 h-5"></i></button>
            </div>`;
            root.innerHTML = html;
        }

        function renderList(root) {
            const list = [...db].sort((a,b) => b.date.localeCompare(a.date));
            root.innerHTML = `<div class="px-5 py-6 animate-in fade-in"><h1 class="text-xl font-bold mb-6 text-important">전체 기록</h1>${list.map(it => `
                <div class="bg-zinc-900 light-mode:bg-white p-4 rounded-2xl mb-3 border border-white/5 shadow-sm">
                    <div class="text-[10px] font-bold text-indigo-500 mb-1 uppercase">${it.date} | ${it.time || '--:--'}</div>
                    <div class="text-important font-bold text-lg mb-1">${it.note}</div>
                    <div class="flex justify-between items-center text-sm opacity-50"><span>${it.supplier || '미지정'}</span><b>${formatKRW(it.amount)}원</b></div>
                </div>`).join('') || '<p class="text-center py-20 opacity-30">기록이 없습니다.</p>'}</div>`;
        }

        function renderSales(root) {
            const mStr = `${calContext.getFullYear()}-${String(calContext.getMonth()+1).padStart(2,'0')}`;
            const mData = db.filter(x => x.date.startsWith(mStr));
            const total = mData.reduce((a,b) => a + (Number(b.amount)||0), 0);
            root.innerHTML = `<div class="px-5 py-6 text-center animate-in fade-in">
                <h2 class="text-lg font-bold opacity-50 uppercase tracking-widest">${calContext.getMonth()+1}월 매출 통계</h2>
                <div class="text-4xl font-black text-indigo-500 my-8">${formatKRW(total)}<span class="text-xl ml-1 font-normal opacity-50">원</span></div>
                <div class="bg-zinc-900 light-mode:bg-white rounded-3xl p-2 shadow-inner">
                    ${mData.map(it => `<div class="flex justify-between p-4 border-b border-white/5 text-sm"><span>${it.date.split('-')[2]}일 (${it.supplier || '미지정'})</span><b class="text-important">${formatKRW(it.amount)}원</b></div>`).join('') || '<p class="p-10 opacity-30">매출 내역 없음</p>'}
                </div>
            </div>`;
        }

        function renderHome(root) {
            root.innerHTML = `<div class="px-10 py-20 text-center animate-in zoom-in duration-300">
                <div class="w-20 h-20 bg-indigo-600 rounded-3xl mx-auto flex items-center justify-center text-4xl font-black text-white mb-8 shadow-2xl">L</div>
                <h2 class="text-2xl font-black text-important mb-2">안녕하세요!</h2>
                <p class="text-sm opacity-50 mb-12">로그릿 V152 공식 버전을 사용 중입니다.</p>
                <button onclick="navTo('e_cal')" class="btn-primary">일정 확인하기</button>
            </div>`;
        }

        function renderSettings(root) {
            root.innerHTML = `<div class="px-6 py-6 animate-in slide-in-from-right"><h2 class="text-xl font-bold mb-8 text-important">시스템 설정</h2><div class="space-y-4">
                <div class="flex justify-between items-center p-5 bg-zinc-900 light-mode:bg-slate-100 rounded-2xl"><span class="font-bold">화이트 모드</span><button onclick="isLightMode=!isLightMode; applyTheme(); localStorage.setItem('theme_is_light', isLightMode); render();" class="w-12 h-6 bg-zinc-700 rounded-full relative"><div class="w-4 h-4 bg-white rounded-full absolute top-1 left-1" style="${isLightMode?'transform:translateX(24px)':''}"></div></button></div>
                <button onclick="location.reload(true)" class="w-full p-5 bg-zinc-900 light-mode:bg-slate-100 rounded-2xl font-bold text-left">앱 강제 새로고침</button>
                <button onclick="if(confirm('데이터를 초기화할까요?')){db=[];sync();}" class="w-full p-5 text-red-500 font-bold text-left opacity-60">전체 데이터 초기화</button>
            </div></div>`;
        }

        window.openEntryModal = () => {
            const d = selectedDate || new Date().toISOString().split('T')[0];
            const note = prompt("활동 내용을 입력하세요", "");
            if(note) {
                const amt = prompt("매출 금액을 입력하세요 (숫자만)", "0");
                db.push({ id: Date.now(), date: d, note: note, amount: parseInt(amt) || 0, supplier: "미지정" });
                sync();
            }
        };
    </script>
</body>
</html>

